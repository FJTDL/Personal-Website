<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Abel Tasman Mice | Finn de Lange</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans text-gray-900">
  <!-- Navbar -->
  <nav class="bg-white shadow-md py-4">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-4">
      <a href="index.html" class="font-bold text-lg">← Back to Portfolio</a>
    </div>
  </nav>

  <!-- Project Content -->
  <section class="bg-gradient-to-r from-red-500 to-yellow-600 text-white py-20  mx-auto text-center">
    <div class="max-w-4xl mx-auto text-center">
    <h1 class="text-4xl font-bold mb-6">Statistical Methods in Analysing Mice Migration in Abel Tasman National Park</h1>
    <p class="text-lg leading-relaxed mb-6">
      Building on a project from STATS 399 - Capstone, the objective of this analysis is to determine
      if the 2007 extermination events on the Tonga and Adele islands were successful, the implications of this,
      and what further insights can be gained from the project.
    </p>
    </div>
  </section>
  <section class="max-w-4xl mx-auto py-16 px-4">


    <!-- Techniques -->
    <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Techniques</h2>
    <ul class="list-disc list-inside mb-10 space-y-2">
      <li>Partial Least Squares - Discriminant Analysis (PLS-DA)</li>
      <li>Hamming Distance Hierarchical Clustering</li>
      <li>Permutation Testing</li>
    </ul>

  <!-- Plots Section -->
  <section class="max-w-4xl mx-auto px-4 space-y-16">
    <!-- Preamble -->
    <div>
      <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Preamble</h2>
      <p class="text-gray-700 leading-relaxed">
        Firstly, I found the original theory of using Principle Component Analysis (PCA)
        to be a very interesting idea, and found that it did yield accurate results.
        <br>
        <br>
        However, when it comes to trying to differentiate between groups, PCA is not the
        first technique that comes to mind. Instead, that would go to a LDA. However, LDA
        has very stringent requirements that are rarely met, and QDA while less stringent
        still has requirements. Although I could have tested for this, I simply opted for 
        the non-parametric PLS-DA method instead as you will see.
        <br>
        <br>
        Additionally, since we are considering genetic data, it would make sense to try a
        tree model, akin to phylogenetic trees. This is easily done using the base R <b class="bg-blue-100 text-blue-700 px-1 rounded">dist()</b>
        and <b class="bg-blue-100 text-blue-700 px-1 rounded">hclust()</b> functions, but the problem was that the distances programmed for the base
        methods do not include Hamming distance, the one we need for this problem.
        <br>
        <br>
        In this web-report, you will find explanations to my methods, as well as my conclusions.
        However, this will, in all likelihood, end up being a shortened version without much
        of the statistical depth I would usually include in a report. Why? Because I do not
        expect anyone on my personal website to be a statistican.
      </p>
    </div>

    <!-- Slideshow 1 -->
    <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">PLS-DA</h2>
    <div class="relative w-full overflow-hidden rounded-xl shadow-lg bg-white">
      <div class="flex transition-transform duration-500" id="slideshow1">
        <!-- Slide 1 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/PLS-DA/full-plsda.png" alt="Plot 1" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">We can see a rather clear overlap of the groups, most significantly
            with the mainland group. So, let's remove it!
          </p>
        </div>
        <!-- Slide 2 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/PLS-DA/mainland_remove_plsda.png" alt="Plot 2" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">Removing the mainland starts to show some separation between the groups,
            but we now see that the Adele15 population overlaps significantly with all other populations.
          </p>
        </div>
        <!-- Slide 3 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/PLS-DA/af_plsda.png" alt="Plot 3" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">We see that the Adele populations all appear to overlap with each other significantly,
            as well as the Fisherman island population. There is some indication that the Fisherman population is
            more likely to be a subset of the Adele population than the mainland.
          </p>
        </div>
        <!-- Slide 4 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/PLS-DA/am_plsda.png" alt="Plot 4" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">This plot demonstrates that both Adele populations are very similar to the Mainland. Unfortunately, due to
            significant overlap in the ellipses, we cannot claim much about the populations.
          </p>
        </div>
        <!-- Slide 5 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/PLS-DA/a_plsda.png" alt="Plot 5" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">The Adele populations appear to be sufficently distinct on this plot, but the overlap of these groups
            shows that they at least share a common ancestor, beyond the fact they are the same species.
          </p>
        </div>
      </div>
      <!-- Navigation -->
      <button onclick="prevSlide('slideshow1')" class="absolute top-1/2 left-4 -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full">❮</button>
      <button onclick="nextSlide('slideshow1')" class="absolute top-1/2 right-4 -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full">❯</button>
    </div>

    <p>It is worth nothing that in all of these analyses, the PLS-DA method captures very low levels of variation. Even when the method is providing a high
      level of separation visually, this is important to remember.
      <br>
      <br>
      Overall, these plots tell us that there is fairly strong evidence to suspect all populations are descended from the mainland in some way,
      that the Adele and Tonga 2015 popoulations are likely to be recent invaders rather than survivors, and that Fisherman island was likely colonised
      by Adele island rats prior to the 2007 eradication event.
    </p>

    <p>Ideally, what we want to do now is find a way to compare how similar the rats are, and use this to construct a cluster solution, similar to phylogenetic trees.
      Given we are working with genetic data, this is a logical progression, and using the <b class="bg-blue-100 text-blue-700 px-1 rounded">dist()</b> and 
      <b class="bg-blue-100 text-blue-700 px-1 rounded">hclust()</b> functions.
      <br>
      <br>
      However, one important detail is that the variables themselves are numbers, but these numbers are labels, not actual numeric values. This means that using
      Manhattan, Euclidean or many other forms of distance will treat these incorrectly, and give a false idea of their similarity. A binary method would be better,
      but the base R binary distance checks if the entire observation is the same as the other, not on a columnwise system. 
      <br>
      <br>
      Thankfully, there is a well known distance we can easily implement to fix this, called the <b>Hamming Distance</b>, which we can implement easily with the function
      below.
    </p>
    <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Hamming Distance Function</h2>
    <pre class="bg-black text-white p-4 rounded-lg overflow-x-auto text-sm">
      <code>
        match_dist <- function(x, y) {
          sum(x != y) 
        }
      </code>
    </pre>
    <p>This does, however, mean that we also need to install and load the <b class="bg-blue-100 text-blue-700 px-1 rounded">Proxy</b>
    package, so be aware of this if you attempt to recreate my code.
    <br>
    Additionally, note that the red clusters are somewhat arbitrary, and have mostly been used for illustrative purposes
    rather than forming proper clusters.
    </p>

    <!-- Slideshow 2 -->
    <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Hierarchical Clustering Solutions.</h2>
    <div class="relative w-full overflow-hidden rounded-xl shadow-lg bg-white">
      <div class="flex transition-transform duration-500" id="slideshow2">
        <!-- Slide 1 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/Trees/full_tree.png" alt="Plot 6" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">The full cluster solution shows a distinct branch of Fisherman island that are most closely related
            to a branch of mostly Adele07 mice, both of which are far removed from the other branches. We also observe a clear cluster of Tonga07
            mice also rather distinct of other groups, while the Mainland and 2015 populations all appear to cluster together in
            roughly the same branches.
          </p>
        </div>
        <!-- Slide 2 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/Trees/fam_tree.png" alt="Plot 7" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">Considering the Adele populations with the Fisherman and Mainland, we see quite clearly the Adele15
            and Fisherman populations form distinct clusters, and are most closely related to each other, reasonably removed from the mainland
            and Adele15 populations that seem to cluster with each other, with Adele15 forming several smaller clades within the larger cluster
            instead of clustering together.
          </p>
        </div>
        <!-- Slide 3 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/Trees/ma_tree.png" alt="Plot 8" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">When considering just the Adele and Mainland populations, we see very clearly that the Adele07 population forms
            a distinct cluster by itself, while the Adele15 mice tend to "mix" with the Mainland population, seemingly randomly.
          </p>
        </div>
        <!-- Slide 4 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/Trees/mat15_tree.png" alt="Plot 9" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">Comparing the 2015 populations with the Mainland population, we see almost perfect mixing between the populations,
            indicating that these populations are not distinct of each other.
          </p>
        </div>
        <!-- Slide 5 -->
        <div class="min-w-full p-6 text-center">
          <img src="Static/Trees/mt_tree.png" alt="Plot 10" class="mx-auto rounded-lg mb-4" />
          <p class="text-gray-700">Once again we observe a 2007 population as being highly distinctive, while the 2015 "mixes" with the mainland.
            However, we observe much less scattering of the 2015 Tonga population compared to Adele, and in particular observe a distinctive clade emerge
            within one of the clusters.
          </p>
        </div>
      </div>
      <!-- Navigation -->
      <button onclick="prevSlide('slideshow2')" class="absolute top-1/2 left-4 -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full">❮</button>
      <button onclick="nextSlide('slideshow2')" class="absolute top-1/2 right-4 -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full">❯</button>
    </div>

    <h2 class="text-2xl font-semibold mb-4">So what do we learn from these clustering solutions?</h2>
    <ul class = "list-disc list-inside space-y-2">
      <li>There is strong indication that the Fisherman07 Population is likely a "spin off" of the Adele07 population.</li>
      <li>There is strong evidence to suggest that the 2007 eradication events were successful on all islands.</li>
      <li>It is likely that the Adele15 population is the result of either multiple invasions, or constant flow of migrating rats from the mainland.</li>
      <li>The 2015 Populations are not yet sufficiently established to be distinct of the mainland lineage.</li>
    </ul>

  </section>
  <br>
  <h2 class = "text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Permutation Testing</h2>
  <p>One advantage to this distance-based method is that we can compare the distances between two groups for statistical significance,
  and draw a more robust conclusion about the origin of the mice. However, many of the graphical methods proved viable in finding the 
  likely conclusions, so we do not need to apply many of these. In fact, we shall only apply one, to try to answer the question of if
  the Fisherman island population really is a "spin-off" of the Adele07 population, or if it came from the mainland.</p>
  <br>
  <h2 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Permutation Testing</h2>
  <pre class="bg-black text-white p-4 rounded-lg overflow-x-auto text-sm">
    <code>
      adele7 <- grouped_mainland %>%
        filter(
          pop == "Adele07"
        )

      adele15 <- grouped_mainland %>%
        filter(
          pop == "Mainland"
        )

      adele7_geno <- adele7[, -(1:2)]
      adele15_geno <- adele15[, -(1:2)]

      dist_matrix <- as.matrix(dist(rbind(adele7_geno, adele15_geno)), method = match_dist)

      n_f <- nrow(adele7_geno)
      n_a <- nrow(adele15_geno)

      adele7_idx <- 1:n_f
      adele15_idx <- (n_f + 1):(n_f + n_a)

      pairwise_distances <- dist_matrix[adele7_idx, adele15_idx]
      a_a_distance <- mean(pairwise_distances)

      obs_diff <- a_a_distance - a_f_distance

      subset_data <- subset(grouped_mainland, pop %in% c("Fisherman07", "Adele07", "Adele15"))
      geno_only <- subset_data[, -(1:2)]  # remove ID/Pop columns
      pop_labels <- subset_data$pop


      n_perm <- 10000
      perm_diff <- numeric(n_perm)

      set.seed(123)

      for (i in 1:n_perm) {
        shuffled <- sample(pop_labels)

        fisherman_idx <- which(shuffled == "Fisherman07")
        adele07_idx   <- which(shuffled == "Adele07")
        adele15_idx   <- which(shuffled == "Adele15")
        f_a_dist_perm <- mean(as.matrix(dist(geno_only, method = match_dist))[fisherman_idx, adele07_idx])
        a_a_dist_perm <- mean(as.matrix(dist(geno_only, method = match_dist))[adele07_idx, adele15_idx])

        perm_diff[i] <- a_a_dist_perm - f_a_dist_perm
      }

      p_value <- (sum(perm_diff >= obs_diff) + 1) / (n_perm + 1)

      p_value
    </code>
  </pre>
  <br>
  <h1 class="text-2xl font-semibold mb-4 bg-gradient-to-r from-red-500 to-yellow-600 text-white px-4 py-2 rounded-lg inline-block">Conclusions</h1>

  <p>
    Many of the conclusions drawn have been listed in prior sections, so consider this a summary.
    <br>
    We can be quite confident that the 2007 eradication events were successful, and that the 2015 populations were seeded from the mainland.
    At the same time, we can also be quite confident that the Fisherman island 2007 population was seeded by the Adele 2007 population.
    This means that while the eradication method works, as long as there are mice on the mainland, they will get on the offshore islands as
    well, and may spread to other islands they may not have swum to from the mainland due to distance issuse, using the immediate offshore islands
    as "staging grounds".
  </p>

  <!-- Footer -->
  <footer class="bg-white py-6 mt-12 shadow-inner">
    <div class="max-w-6xl mx-auto text-center text-gray-500">
      2025 Finn de Lange
    </div>
  </footer>

  <!-- Slideshow JS -->
  <script>
    const slideIndexes = { slideshow1: 0, slideshow2: 0 };

    function showSlide(id) {
      const container = document.getElementById(id);
      const index = slideIndexes[id];
      container.style.transform = `translateX(-${index * 100}%)`;
    }

    function nextSlide(id) {
      const container = document.getElementById(id);
      const total = container.children.length;
      slideIndexes[id] = (slideIndexes[id] + 1) % total;
      showSlide(id);
    }

    function prevSlide(id) {
      const container = document.getElementById(id);
      const total = container.children.length;
      slideIndexes[id] = (slideIndexes[id] - 1 + total) % total;
      showSlide(id);
    }
  </script>
</body>
</html>
